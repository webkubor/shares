import{c as A,b as D}from"./random-O7WolsKF.js";import{d as R,a5 as U,r as I,k as H,q as T,K as b,L as C,S as f,R as d,Q as S,P as x,M as z,N as m,F as B,_ as j,$ as E,b as v,Z as g,a0 as M,a1 as V}from"./vendor-DvKkXVKX.js";import{n as F,v as O,B as K,k as Q}from"./naive-ByXUNVmA.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";class G{constructor(a,o=1,l="defaultStore"){this.dbName=a,this.version=o,this.storeName=l,this.dbPromise=new Promise((s,e)=>{let n=window.indexedDB.open(this.dbName,this.version);n.onerror=()=>e(n.error),n.onsuccess=t=>s(t.target.result),n.onupgradeneeded=t=>{let c=t.target.result;c.objectStoreNames.contains(this.storeName)||c.createObjectStore(this.storeName,{keyPath:"id"}).createIndex("name","name",{unique:!0})}})}async add(a){let e=(await this.dbPromise).transaction([this.storeName],"readwrite").objectStore(this.storeName).add(a);return new Promise((n,t)=>{e.onsuccess=()=>n(e.result),e.onerror=()=>t(e.error)})}async put(a){let e=(await this.dbPromise).transaction([this.storeName],"readwrite").objectStore(this.storeName).put(a);return new Promise((n,t)=>{e.onsuccess=()=>n(e.result),e.onerror=()=>t(e.error)})}async delete(a){let e=(await this.dbPromise).transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(a);return new Promise((n,t)=>{e.onsuccess=()=>n(),e.onerror=()=>t(e.error)})}async deleteAll(){let s=(await this.dbPromise).transaction([this.storeName],"readwrite").objectStore(this.storeName).openCursor();return new Promise((e,n)=>{s.onsuccess=t=>{let c=t.target.result;if(c){let p=c.delete();p.onsuccess=()=>c.continue(),p.onerror=()=>n(p.error)}else e()},s.onerror=()=>n(s.error)})}async get(a,o){let e=(await this.dbPromise).transaction([this.storeName],"readonly").objectStore(this.storeName);console.log(a,o);let t=e.index(a).get(o);return new Promise((c,p)=>{t.onsuccess=()=>c(t.result),t.onerror=()=>p(t.error)})}async fuzzySearch(a){return(await this.getAll()).filter(s=>s.name&&s.name.toLowerCase().includes(a.toLowerCase()))}async getAll(){let l=(await this.dbPromise).transaction([this.storeName],"readonly").objectStore(this.storeName),s=[],e=l.openCursor();return new Promise((n,t)=>{e.onsuccess=c=>{let p=c.target.result;p?(s.push(p.value),p.continue()):n(s)},e.onerror=()=>t(e.error)})}}const k=N=>(M("data-v-b1ed2105"),N=N(),V(),N),J={id:"card-container"},W=k(()=>m("span",null," ID ",-1)),X=k(()=>m("span",null," 名称 ",-1)),Y=k(()=>m("span",null," 邮箱 ",-1)),ee=k(()=>m("span",null," 操作 ",-1)),te=R({__name:"scroll",setup(N){U();let a=I([]),o=I(null),l=I([]),s=new G("MyAppDatabase",1,"Users");H(async()=>{await T(),$(),c(),console.log(document.referrer,1111)});async function e(){var i,h;let r={id:A(),name:D(10),email:D(5)+"@example.com"};try{let _=await s.add(r);(i=window.$message)==null||i.success(`新用户已添加，ID为：${_}`),await c()}catch(_){console.error("添加用户失败:",_),(h=window.$message)==null||h.error(`新用户添加失败，ID为：${r.id}`)}}function n(){l.value=[]}async function t(r){var i;try{await s.delete(r),(i=window.$message)==null||i.success(`id为${r}的用户已从数据库中删除`),await c()}catch(h){console.error("删除用户失败:",h)}}async function c(){try{let r=await s.getAll();a.value=r,console.log("所有用户数据:",r)}catch(r){console.error("获取所有用户失败:",r)}}async function p(){var r;if(!o.value){(r=window.$message)==null||r.error("请输入用户名称");return}console.log(o.value,"name"),l.value=[];try{let i=await s.fuzzySearch(o.value);console.log("查询到的用户:",i),l.value=[...l.value,...i]}catch(i){console.error("获取用户失败:",i)}}function q(r){return document.getElementById(r)}function $(){let r=q("card-container");r&&(console.log("获取到了DOM"),r.addEventListener("scroll",function(){document.querySelectorAll(".card").forEach(h=>{const _=h.offsetTop,w=h.offsetHeight,y=r.scrollTop,u=r.offsetHeight;_>=y&&_+w<=y+u?h.classList.add("puffIn"):h.classList.remove("puffIn")})}))}return(r,i)=>{const h=O,_=K,w=Q,y=F;return b(),C(B,null,[f(y,{title:"indexDB测试"},{default:d(()=>[f(w,null,{default:d(()=>[f(w,null,{default:d(()=>[f(h,{value:S(o),"onUpdate:value":i[0]||(i[0]=u=>E(o)?o.value=u:o=u),type:"text",placeholder:"请输入用户名称"},null,8,["value"]),f(_,{type:"primary",onClick:p},{default:d(()=>[v(" 搜索 ")]),_:1})]),_:1}),f(_,{type:"primary",onClick:e},{default:d(()=>[v(" 新增数据 ")]),_:1}),f(_,{type:"primary",onClick:n},{default:d(()=>[v(" 重置 ")]),_:1})]),_:1})]),_:1}),S(l).length?(b(),x(y,{key:0,title:"检索结果"},{default:d(()=>[(b(!0),C(B,null,j(S(l),(u,P)=>(b(),x(w,{align:"center",justify:"space-between",class:"card-row",key:P},{default:d(()=>[m("span",null,g(u.id),1),m("span",null,g(u.name),1),m("span",null,g(u.email),1),m("span",null,[f(_,{type:"error",ghost:"",onClick:L=>t(u.id)},{default:d(()=>[v(" 删除 ")]),_:2},1032,["onClick"])])]),_:2},1024))),128))]),_:1})):z("",!0),m("div",J,[f(y,null,{default:d(()=>[f(w,{align:"center",justify:"space-between",class:"card-row"},{default:d(()=>[W,X,Y,ee]),_:1})]),_:1}),(b(!0),C(B,null,j(S(a),(u,P)=>(b(),x(y,{key:P},{default:d(()=>[f(w,{align:"center",justify:"space-between",class:"card-row"},{default:d(()=>[m("span",null,g(u.id),1),m("span",null,g(u.name),1),m("span",null,g(u.email),1),m("span",null,[f(_,{type:"error",ghost:"",onClick:L=>t(u.id)},{default:d(()=>[v(" 删除 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))])],64)}}}),ae=Z(te,[["__scopeId","data-v-b1ed2105"]]);export{ae as default};
