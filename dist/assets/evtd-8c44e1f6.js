const t={mousemoveoutside:new WeakMap,clickoutside:new WeakMap};function e(e,n,o){const i=t[e];let r=i.get(n);void 0===r&&i.set(n,r=new WeakMap);let u=r.get(o);return void 0===u&&r.set(o,u=function(t,e,n){if("mousemoveoutside"===t){const t=t=>{e.contains(t.target)||n(t)};return{mousemove:t,touchstart:t}}if("clickoutside"===t){let t=!1;const o=n=>{t=!e.contains(n.target)},i=o=>{t&&(e.contains(o.target)||n(o))};return{mousedown:o,mouseup:i,touchstart:o,touchend:i}}return{}}(e,n,o)),u}const{on:n,off:o}=function(){if("undefined"==typeof window)return{on:()=>{},off:()=>{}};const t=new WeakMap,i=new WeakMap;function r(){t.set(this,!0)}function u(){t.set(this,!0),i.set(this,!0)}function c(t,e,n){const o=t[e];return t[e]=function(){return n.apply(t,arguments),o.apply(t,arguments)},t}function s(t,e){t[e]=Event.prototype[e]}const a=new WeakMap,f=Object.getOwnPropertyDescriptor(Event.prototype,"currentTarget");function d(){var t;return null!==(t=a.get(this))&&void 0!==t?t:null}function p(t,e){void 0!==f&&Object.defineProperty(t,"currentTarget",{configurable:!0,enumerable:!0,get:null!=e?e:f.get})}const l={bubble:{},capture:{}},v={},b=function(){const e=function(e){const{type:n,eventPhase:o,target:f,bubbles:v}=e;if(2===o)return;const b=1===o?"capture":"bubble";let w=f;const h=[];for(;null===w&&(w=window),h.push(w),w!==window;)w=w.parentNode||null;const g=l.capture[n],m=l.bubble[n];if(c(e,"stopPropagation",r),c(e,"stopImmediatePropagation",u),p(e,d),"capture"===b){if(void 0===g)return;for(let n=h.length-1;n>=0&&!t.has(e);--n){const t=h[n],o=g.get(t);if(void 0!==o){a.set(e,t);for(const t of o){if(i.has(e))break;t(e)}}if(0===n&&!v&&void 0!==m){const n=m.get(t);if(void 0!==n)for(const t of n){if(i.has(e))break;t(e)}}}}else if("bubble"===b){if(void 0===m)return;for(let n=0;n<h.length&&!t.has(e);++n){const t=h[n],o=m.get(t);if(void 0!==o){a.set(e,t);for(const t of o){if(i.has(e))break;t(e)}}}}s(e,"stopPropagation"),s(e,"stopImmediatePropagation"),p(e)};return e.displayName="evtdUnifiedHandler",e}(),w=function(){const t=function(t){const{type:e,eventPhase:n}=t;if(2!==n)return;const o=v[e];void 0!==o&&o.forEach((e=>e(t)))};return t.displayName="evtdUnifiedWindowEventHandler",t}();function h(t,e){const n=l[t];return void 0===n[e]&&(n[e]=new Map,window.addEventListener(e,b,"capture"===t)),n[e]}function g(t,e){let n=t.get(e);return void 0===n&&t.set(e,n=new Set),n}function m(t,n,i,r){const u=function(t,n,i,r){if("mousemoveoutside"===t||"clickoutside"===t){const u=e(t,n,i);return Object.keys(u).forEach((t=>{o(t,document,u[t],r)})),!0}return!1}(t,n,i,r);if(u)return;const c=!0===r||"object"==typeof r&&!0===r.capture,s=c?"capture":"bubble",a=h(s,t),f=g(a,n);if(n===window){if(!function(t,e,n,o){const i=l[e][n];if(void 0!==i){const e=i.get(t);if(void 0!==e&&e.has(o))return!0}return!1}(n,c?"bubble":"capture",t,i)&&function(t,e){const n=v[t];return!(void 0===n||!n.has(e))}(t,i)){const e=v[t];e.delete(i),0===e.size&&(window.removeEventListener(t,w),v[t]=void 0)}}f.has(i)&&f.delete(i),0===f.size&&a.delete(n),0===a.size&&(window.removeEventListener(t,b,"capture"===s),l[s][t]=void 0)}return{on:function(t,o,i,r){let u;u="object"==typeof r&&!0===r.once?e=>{m(t,o,u,r),i(e)}:i;if(function(t,o,i,r){if("mousemoveoutside"===t||"clickoutside"===t){const u=e(t,o,i);return Object.keys(u).forEach((t=>{n(t,document,u[t],r)})),!0}return!1}(t,o,u,r))return;const c=g(h(!0===r||"object"==typeof r&&!0===r.capture?"capture":"bubble",t),o);if(c.has(u)||c.add(u),o===window){const e=function(t){return void 0===v[t]&&(v[t]=new Set,window.addEventListener(t,w)),v[t]}(t);e.has(u)||e.add(u)}},off:m}}();export{o as a,n as o};
